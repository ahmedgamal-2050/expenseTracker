<h1 class="text-center text-lg font-semibold mb-4">
  {{ 'expenses_form_screen_add_expense_title' | translate }}
</h1>

<form
  [formGroup]="form"
  (ngSubmit)="submit()"
  class="grid lg:grid-cols-2 gap-4"
>
  <!-- Category -->
  <div class="lg:col-span-2">
    <label for="categoryInput" class="text-sm font-medium inline-block pb-2">
      {{ 'expenses_form_screen_categories_label' | translate }}
    </label>

    <div class="relative">
      <select
        type="select"
        readonly
        [value]="form.get('category')?.value ?? ''"
        (change)="onCategorySelect($event.target)"
        id="categoryInput"
        class="w-full rounded-md border border-gray-200 bg-gray-100 px-3 py-2 text-sm dark:border-gray-700 dark:bg-gray-800 appearance-none placeholder:text-gray-500"
      >
        <option value="''">
          {{ 'expenses_form_screen_select_category_label' | translate }}
        </option>
        @for (category of categories(); track category.key) {
        <option [value]="category.key">{{ category.label }}</option>
        }
      </select>

      <i-lucide
        [img]="chevronDown"
        class="absolute end-3 top-1/2 -translate-y-1/2 size-4 text-gray-500"
      />
    </div>
  </div>

  <!-- Amount -->
  <div class="">
    <label for="amountInput" class="text-sm font-medium inline-block pb-2">
      {{ 'expenses_form_screen_amount_label' | translate }}
    </label>

    <input
      type="number"
      formControlName="amount"
      placeholder="$ 500"
      step="0.01"
      min="0.01"
      id="amountInput"
      class="w-full rounded-md border border-gray-200 bg-gray-100 px-3 py-2 text-sm dark:border-gray-700 dark:bg-gray-800 placeholder:text-gray-500"
    />
    @if (form.get('amount')?.touched && form.get('amount')?.invalid) {
    <p class="mt-1 text-xs text-red-600">
      Amount is required and must be greater than 0.
    </p>
    }
  </div>

  <!-- Date -->
  <div class="">
    <label for="dateInput" class="text-sm font-medium inline-block pb-2">
      {{ 'expenses_form_screen_date_label' | translate }}
    </label>

    <div class="relative">
      <input
        #dateInput
        type="date"
        formControlName="date"
        id="dateInput"
        (click)="openDatePicker(dateInput)"
        class="w-full rounded-md border border-gray-200 bg-gray-100 px-3 py-2 text-start text-sm cursor-pointer dark:border-gray-700 dark:bg-gray-800 placeholder:text-gray-500"
      />
      @if (form.get('date')?.touched && form.get('date')?.invalid) {
      <p class="mt-1 text-xs text-red-600">Date is required.</p>
      }

      <label
        for="dateInput"
        class="absolute end-3 top-1/2 -translate-y-1/2 cursor-pointer"
      >
        <i-lucide
          [img]="calendarIcon"
          class="absolute end-3/4 top-1/2 -translate-y-1/2 size-4 text-gray-500"
        />
      </label>
    </div>
  </div>

  <!-- Receipt -->
  <div class="lg:col-span-2">
    <label for="receiptInput" class="text-sm font-medium inline-block pb-2">
      {{ 'expenses_form_screen_attach_receipt_label' | translate }}
    </label>

    <div class="relative">
      <input
        type="file"
        (change)="onFileSelected($event)"
        id="receiptInput"
        class="w-full rounded-md border border-gray-200 bg-gray-100 px-3 py-2 text-sm file:hidden dark:border-gray-700 dark:bg-gray-800 cursor-pointer placeholder:text-gray-500"
      />

      <label for="receiptInput" class="cursor-pointer">
        <i-lucide
          [img]="imageIcon"
          class="absolute end-3 top-1/2 -translate-y-1/2 size-4 text-gray-500"
        />
      </label>
    </div>
  </div>

  <!-- Categories Icon List -->
  <div class="lg:col-span-2">
    <h2 class="text-base font-semibold mb-4">
      {{ 'expenses_form_screen_categories_label' | translate }}
    </h2>

    <div class="grid grid-cols-4 gap-4 md:grid-cols-6 lg:grid-cols-8">
      @for (category of categories(); track category.key) {
      <button
        type="button"
        (click)="onQuickCategorySelect(category.key)"
        class="flex flex-col items-center gap-2 cursor-pointer"
      >
        <span
          class="grid place-items-center rounded-full size-12"
          [class]="
            !category.isSelected
              ? (category.key | categoryOption).style
              : 'bg-blue-600 text-white'
          "
        >
          <i-lucide
            [img]="(category.key | categoryOption).icon"
            class="size-5"
          />
        </span>

        <span
          class="text-2xs font-semibold"
          [class]="!category.isSelected ? 'text-gray-700' : 'text-blue-700'"
        >
          {{ category.label }}
        </span>
      </button>
      }

      <button
        type="button"
        (click)="handleAddCategory()"
        class="flex flex-col items-center gap-2 cursor-pointer"
      >
        <span
          class="grid place-items-center rounded-full size-12 border border-blue-700 dark:border-gray-700 dark:bg-gray-800 text-blue-700"
        >
          <i-lucide [img]="plusIcon" class="size-5" />
        </span>

        <span class="text-2xs text-gray-700 font-semibold">
          {{ 'expenses_form_screen_add_category_label' | translate }}
        </span>
      </button>
    </div>
  </div>

  <!-- Submit button -->
  <div class="lg:col-span-2 lg:mt-6 mt-4">
    <button
      type="submit"
      class="mx-auto block w-full max-w-md rounded-md bg-blue-600 px-4 py-3 text-white cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
    >
      {{ 'expenses_form_screen_save_label' | translate }}
    </button>
  </div>
</form>

<app-toast [toast]="toast()" />
